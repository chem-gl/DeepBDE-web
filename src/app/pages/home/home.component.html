<div class="home-container">
  <header class="hero-section">
    <h1>DeepBDE</h1>
    <p class="subtitle">
      Graph Neural Network for Bond Dissociation Enthalpies
    </p>
    <p class="description">
      A web tool based on a Graph Neural Network (GNN) that quickly and
      accurately predicts bond dissociation enthalpies (BDE) in organic
      molecules using SMILES representations
    </p>
    <div class="citation-section">
      <p class="citation-text">
        Based on the official implementation of
        <a href="https://github.com/MSRG/DeepBDE/" target="_blank" rel="noopener noreferrer" class="github-link">
          DeepBDE (MSRG/DeepBDE)
        </a>
      </p>
    </div>
  </header>

  <section class="analysis-section">
    <div class="mode-selector">
      <button (click)="setMode('smiles')" [class.active]="selectedMode === 'smiles'" class="mode-btn">
        SMILES Analysis
      </button>
      <button (click)="setMode('fragments')" [class.active]="selectedMode === 'fragments'" class="mode-btn">
        Draw Molecule
      </button>
    </div>

    @if(selectedMode === 'smiles') {
    <div class="input-section smiles-section">
      <div class="input-group">
        <label for="smiles-input">Enter SMILES Notation:</label>
        <input id="smiles-input" type="text" [(ngModel)]="smilesInput" placeholder="e.g., CCOc1cccc(O)c1"
          class="smiles-input" />
        <small class="input-help">
          Enter a valid SMILES string for a single molecule (no dots "." allowed for fragments)
        </small>
      </div>
      <div class="action-buttons">
        <button class="btn-primary" (click)="getMoleculeData()" [disabled]="!smilesInput.trim() || loadingInfo">
          {{ loadingInfo ? 'Analyzing...' : 'Get Molecule Info' }}
        </button>
      </div>
    </div>
    } @else if(selectedMode === 'fragments') {
    <div class="draw-section">
      <h3>Draw Your Molecule</h3>
      <p class="draw-help">Use the molecular editor below to draw your molecule structure.</p>
      <div class="draw-warning">
        <small>‚ö†Ô∏è Please draw only ONE connected molecule. Disconnected fragments will be rejected.</small>
      </div>

      <iframe #ketcherFrame src="ketcher/index.html" width="100%" height="700" frameborder="0"></iframe>

      <div class="draw-actions">
        <button (click)="getSmiles()" class="btn-secondary" [disabled]="!ketcherLoaded">
          @if(!ketcherLoaded) {
          ‚è≥ Loading Ketcher...
          } @else {
          üìã Get SMILES from Drawing
          }
        </button>

        <button (click)="reloadKetcher()" class="btn-secondary" title="Reload molecular editor">
          üîÑ Reload Editor
        </button>

        @if(smiles) {
        <button (click)="analyzeMoleculeFromDrawing()" class="btn-primary" [disabled]="loadingInfo">
          {{ loadingInfo ? 'Analyzing...' : 'üî¨ Analyze Molecule' }}
        </button>
        }
      </div>

      @if(!ketcherLoaded) {
      <div class="ketcher-loading-info">
        <p>‚è≥ Please wait while the molecular editor loads...</p>
      </div>
      }

      @if(smiles) {
      <div class="smiles-display">
        <h4>Generated SMILES:</h4>
        <div class="smiles-box">
          <code>{{ smiles }}</code>
          <button (click)="copySmilesToClipboard()" class="btn-copy" title="Copy to clipboard">
            üìã
          </button>
        </div>
      </div>
      }
    </div>
    }
  </section>

  <!-- Loading Section -->
  @if(loadingInfo) {
  <div class="loading-section">
    <div class="spinner"></div>
    <p>Getting molecular information...</p>
  </div>
  }
  <!-- Results Section -->
  @if(svgImage) {
  <div class="results-section">
    <h2>Molecular Structure</h2>

    <div class="image-actions">
      <button (click)="downloadSVGFile()" class="btn-download">
        üñºÔ∏è Download SVG
      </button>
      <button (click)="downloadPNGFile()" class="btn-download" style="margin-left: 0.5rem;">
        üì∑ Download PNG
      </button>
    </div>
    <div class="image-container">
      <div class="image-controls">
        <button (click)="zoomIn()" class="control-btn" title="Zoom In">
          üîç+
        </button>
        <button (click)="zoomOut()" class="control-btn" title="Zoom Out">
          üîç-
        </button>
        <button (click)="resetZoom()" class="control-btn" title="Original Size">
          ‚Üª
        </button>
        <button (click)="toggleFullscreen()" class="control-btn" title="Fullscreen">
          ‚õ∂
        </button>
      </div>
      <div class="svg-display" [class.fullscreen]="isFullscreen" #svgContainer (mousedown)="startPan($event)"
        (mousemove)="onPan($event)" (mouseup)="endPan()" (mouseleave)="endPan()" (wheel)="onWheel($event)">
        <!-- Close fullscreen button -->
        @if(isFullscreen) {
        <button (click)="toggleFullscreen()" class="close-fullscreen-btn" title="Close fullscreen">
          ‚úï
        </button>
        }
        <div [innerHTML]="sanitizedSvg" class="svg-content" [style.transform]="getTransform()"></div>
      </div>
    </div>
    <!-- Bond Selection Section -->
    <h3 class="title-bond">Bond calculation options</h3>
    <div class="bond-options-horizontal">
      <div class="checkbox-group">
        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="selectAllBonds" (change)="onSelectAllBondsChange()"
            class="checkbox-input" />
          <span class="checkbox-custom"></span>
          Calculate all non-ring single bonds
        </label>
      </div>

      <div class="custom-bonds-input" [class.disabled]="selectAllBonds">
        <label for="custom-bonds">Select specific bonds or ranges:</label>
        <input id="custom-bonds" type="text" [(ngModel)]="customBondsInput" placeholder="e.g., 1,2,5-8,10"
          class="bonds-input" [disabled]="selectAllBonds" />
      </div>
    </div>
    <div class="bond-help-text">
      <small class="input-help">
        Enter bond numbers separated by commas. Use dashes for ranges (e.g.,
        1,2,5-8,10)
      </small>
    </div>

    <!-- Result Format Section -->

    <h3 class="title-format">Additional printable formats</h3>
    <div class="format-checkboxes">
      <div class="format-checkbox-group">
        <label class="format-checkbox-label">
          <input type="checkbox" [(ngModel)]="includeXyzFormat" class="format-checkbox-input" />
          <span class="format-checkbox-custom"></span>
          XYZ Format
        </label>
      </div>

      <div class="format-checkbox-group">
        <label class="format-checkbox-label">
          <input type="checkbox" [(ngModel)]="includeSmilesFormat" class="format-checkbox-input" />
          <span class="format-checkbox-custom"></span>
          SMILES Format
        </label>
      </div>
    </div>
    <div class="format-help-text">
      <small class="input-help">
        Select one, both, or none of the additional printable formats for the BDE results
      </small>
    </div>
    <div class="bde-action">
      <button class="btn-bde" (click)="getBDE()" [disabled]="loadingBDE">
        {{ loadingBDE ? 'Getting BDE...' : 'Get BDE' }}
      </button>
    </div>
  </div>
  }
  <!-- BDE Results Section -->
  @if(bdeResults) {
  <div class="bde-results-section">
    <h2>Bond Dissociation Energy Results</h2>
    <!-- BDE Table -->
    <div class="bde-table-container">
      <table class="bde-table">
        <thead>
          <tr>
            <th>Bond Index</th>
            <th>Bond Atoms</th>
            <th>Begin Atom</th>
            <th>End Atom</th>
            <th>BDE (kcal/mol)</th>
            <th>Bond Type</th>
          </tr>
        </thead>
        <tbody>
          @for( bond of bdeResults.bonds_predicted; track bond.idx){
          <tr class="bde-row">
            <td>{{ bond.idx }}</td>
            <td class="bond-atoms">{{ bond.bond_atoms }}</td>
            <td>{{ bond.begin_atom_idx }}</td>
            <td>{{ bond.end_atom_idx }}</td>
            <td class="bde-value">
              {{ bond.bde !== null ? (bond.bde | number:'1.2-2') : 'N/A' }}
            </td>
            <td class="bond-type">{{ bond.bond_type || 'Unknown' }}</td>
          </tr>
          }
        </tbody>
      </table>
    </div>

    <!-- Export Buttons -->
    <div class="export-actions">
      <h3>Export Data</h3>
      <div class="export-buttons">
        @if(bdeResults.smiles_list && bdeResults.smiles_list.length > 0){
        <button (click)="downloadSmilesData()" class="btn-export">
          üìÑ Download BDE fragment SMILES
        </button>
        }
        @if(bdeResults.xyz_block){
        <button (click)="downloadXyzData()" class="btn-export">
          üß™ Download BDE fragment XYZ
        </button>
        }
        <button (click)="downloadBdeTableCSV()" class="btn-export">
          üìä Download this Table (CSV)
        </button>
      </div>
    </div>
  </div>
  }
  @if(error) {
  <div class="error-section">
    <h3>‚ö†Ô∏è Error</h3>
    <div class="error-message">
      <p>{{ error }}</p>
      @if(error.includes('multiple fragments') || error.includes('dots')) {
      <div class="error-help">
        <strong>Tip:</strong> Make sure to draw a single connected molecule.
        If you see disconnected parts, use bonds to connect them or remove the extra fragments.
      </div>
      }
    </div>
  </div>
  }
  <footer class="footer-section">
    <p>
      &copy; 2023 DeepBDE. All rights reserved. designed by ????
    </p>
  </footer>
</div>